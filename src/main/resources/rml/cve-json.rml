@prefix rr: <http://www.w3.org/ns/r2rml#>.
@prefix rml: <http://semweb.mmlab.be/ns/rml#>.
@prefix ql: <http://semweb.mmlab.be/ns/ql#> .
@prefix carml: <http://carml.taxonic.com/carml/> .
@prefix ex: <http://www.example.com/> .
@prefix fno:    <http://semweb.datasciencelab.be/ns/function#> .
@prefix fnml:   <http://semweb.mmlab.be/ns/fnml#> .
@prefix dec:    <http://semantics.id/ns/declare#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix nvd: <http://w3id.org/sepses/vocab/ref/NVDSchema#> .
@prefix cvss: <http://w3id.org/sepses/vocab/ref/cvss#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix cve: <http://w3id.org/sepses/vocab/ref/cve#> .
@prefix cpe: <http://w3id.org/sepses/vocab/ref/cpe#> .
@prefix dcterm: <http://purl.org/dc/terms/> .
@prefix grel: <http://users.ugent.be/~bjdmeest/function/grel.ttl#> .

<#SubjectMapping> a rr:TriplesMap ;
  rml:logicalSource [
    rml:source [
      a carml:Stream ;
    ] ;
    rml:referenceFormulation ql:JSONPath ;
    rml:iterator "$.CVE_Items[*]" ;
  ] ;

  rr:subjectMap [
    rr:template "http://w3id.org/sepses/resource/cve/{cve.CVE_data_meta.ID}" ;
  ] ;

  rr:predicateObjectMap [
    rr:predicate rdf:type;
        rr:objectMap [ rr:template "http://w3id.org/sepses/vocab/ref/cve#CVE" ];
    ];
 
  rr:predicateObjectMap [
        rr:predicate dcterm:identifier;
        rr:objectMap [ rml:reference  "cve.CVE_data_meta.ID" ];
        rr:datatype xsd:string ;
    ];

   rr:predicateObjectMap [
        rr:predicate dcterm:description;
        rr:objectMap [  rml:reference "cve.description.description_data[*].value"; ];
        rr:datatype xsd:string ;
    ];

  rr:predicateObjectMap [
        rr:predicate dcterm:issued;
        rr:objectMap [ rml:reference  "publishedDate" ];
        rr:datatype xsd:dateTime ;
    ];

  rr:predicateObjectMap [
    rr:predicate cve:hasReference ;
    rr:objectMap [
      rr:template "http://w3id.org/sepses/resource/cve/reference/{cve.CVE_data_meta.ID}";
    ] ;
  ] ;

    rr:predicateObjectMap [
        rr:predicate dcterm:modified;
        rr:objectMap [ rml:reference  "lastModifiedDate" ];
        rr:datatype xsd:dateTime ;
    ];

    rr:predicateObjectMap [
        rr:predicate cve:hasCWE;
        rr:objectMap [ 
            rr:template "http://w3id.org/sepses/resource/cwe/{cve.problemtype.problemtype_data[*].description[*].value}"
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate cve:hasCVSS3BaseMetric;
        rr:objectMap [ rr:template "http://w3id.org/sepses/resource/cvss/CVSS3BaseMetric/{cve.CVE_data_meta.ID}"; ]
    ];
    
    rr:predicateObjectMap [
        rr:predicate cve:hasCVSS2BaseMetric;
        rr:objectMap [ rr:template "http://w3id.org/sepses/resource/cvss/CVSS2BaseMetric/{cve.CVE_data_meta.ID}"; ]
    ];
    
    rr:predicateObjectMap [
        rr:predicate cve:hasVulnerableConfiguration;
        rr:objectMap [ rr:template "http://w3id.org/sepses/resource/cve/VulnerableConfiguration/{configurations.nodes[*].children[0].cpe_match[0].cpe23Uri}"; ]
    ];


    rr:predicateObjectMap [
        rr:predicate cve:hasVulnerableConfiguration;
        rr:objectMap [ rr:template "http://w3id.org/sepses/resource/cve/VulnerableConfiguration/{configurations.nodes[*].cpe_match[0].cpe23Uri}"; ]
    ];

.

<#VulnerableConfigurationMapping>
    rml:logicalSource [
        rml:source [
            a carml:Stream;
        ];
        rml:referenceFormulation ql:JSONPath;
		rml:iterator "$.CVE_Items[*].configurations.nodes[*]";
    ];

    rr:subjectMap [
        rr:template "http://w3id.org/sepses/resource/cve/VulnerableConfiguration/{children[0].cpe_match[0].cpe23Uri}";
    ];
	rr:predicateObjectMap [
       rr:predicate rdf:type;
       rr:objectMap [ rr:template "http://w3id.org/sepses/vocab/ref/cve#VulnerableConfiguration" ];
    ];


    rr:predicateObjectMap [
        rr:predicate cpe:logicalTestOperator;
        rr:objectMap [ rml:reference "operator" ];
	rr:datatype xsd:string ;
  
        
    ];


  rr:predicateObjectMap [
        rr:predicate cpe:hasLogicalTest;
        rr:objectMap [ rr:template "http://w3id.org/sepses/resource/cpe/LogicalTest/{children[*].cpe_match[0].cpe23Uri}" ];
    ];

.
<#VulnerableConfigurationMapping2>
    rml:logicalSource [
        rml:source [
            a carml:Stream;
        ];
        rml:referenceFormulation ql:JSONPath;
		rml:iterator "$.CVE_Items[*].configurations.nodes[*]";
    ];

    rr:subjectMap [
        rr:template "http://w3id.org/sepses/resource/cve/VulnerableConfiguration/{cpe_match[0].cpe23Uri}";
    ];
	rr:predicateObjectMap [
        rr:predicate rdf:type;
        rr:objectMap [ rr:template "http://w3id.org/sepses/vocab/ref/cve#VulnerableConfiguration" ];
    ];


    rr:predicateObjectMap [
        rr:predicate cpe:logicalTestOperator;
        rr:objectMap [ rml:reference "operator"];
        rr:datatype xsd:string ;  
        
    ];

    rr:predicateObjectMap [
        rr:predicate cpe:logicalTestNegate;
        rr:objectMap [ rml:reference "cpe_match[0].vulnerable" ];
        rr:datatype xsd:boolean ;  

        
    ];


	rr:predicateObjectMap [
        rr:predicate cpe:hasLogicalTestFactRef;
        rr:objectMap [ rr:template "http://w3id.org/sepses/resource/cpe/{cpe_match[*].cpe23Uri}" ];
    ];
.

<#logicalTestMapping>
    rml:logicalSource [
        rml:source [
            a carml:Stream;
        ];
        rml:referenceFormulation ql:JSONPath;
		rml:iterator "$.CVE_Items[*].configurations.nodes[*].children[*]";
    ];

    rr:subjectMap [
        rr:template "http://w3id.org/sepses/resource/cpe/LogicalTest/{cpe_match[0].cpe23Uri}";
    ];
	rr:predicateObjectMap [
        rr:predicate rdf:type;
        rr:objectMap [ rr:template "http://w3id.org/sepses/vocab/ref/cpe#LogicalTest" ];
    ];

    rr:predicateObjectMap [
        rr:predicate cpe:logicalTestOperator;
        rr:objectMap [ rml:reference "operator" ];  
       rr:datatype xsd:string ;
        
    ];

    rr:predicateObjectMap [
        rr:predicate cpe:logicalTestNegate;
        rr:objectMap [ rml:reference "cpe_match[0].vulnerable" ];
        rr:datatype xsd:boolean ;  
        
    ];

	rr:predicateObjectMap [
        rr:predicate cpe:hasLogicalTestFactRef;
        rr:objectMap [ rr:template "http://w3id.org/sepses/resource/cpe/{cpe_match[*].cpe23Uri}" ];
    ];
.

<#CVEFactRef1>
    rml:logicalSource [
        rml:source [
            a carml:Stream;
        ];
        rml:referenceFormulation ql:JSONPath;
		rml:iterator "$.CVE_Items[*].configurations.nodes[*].children[*].cpe_match[*]"
    ];
    rr:subjectMap [
        rr:template "http://w3id.org/sepses/resource/cpe/{cpe23Uri}";
    ];

	rr:predicateObjectMap [
        rr:predicate rdf:type;
        rr:objectMap [ rr:template "http://w3id.org/sepses/vocab/ref/cpe#CPE" ];
    ];
	rr:predicateObjectMap [
        rr:predicate cpe:cpe23;
        rr:objectMap [ rml:reference "cpe23Uri" ];
        rr:datatype xsd:string ;
    ];
.

<#CVEFactRef2>
    rml:logicalSource [
        rml:source [
            a carml:Stream;
        ];
        rml:referenceFormulation ql:JSONPath;
		rml:iterator "$.CVE_Items[*].configurations.nodes[*].cpe_match[*]"
    ];
    rr:subjectMap [
        rr:template "http://w3id.org/sepses/resource/cpe/{cpe23Uri}";
    ];

	rr:predicateObjectMap [
        rr:predicate rdf:type;
        rr:objectMap [ rr:template "http://w3id.org/sepses/vocab/ref/cpe#CPE" ];
    ];
	rr:predicateObjectMap [
        rr:predicate cpe:cpe23;
        rr:objectMap [ rml:reference "cpe23Uri" ];
        rr:datatype xsd:string ;
    ];
.


<#CVSS3BaseMetricMapping>
    rml:logicalSource [
        rml:source [
            a carml:Stream;
        ];
        rml:referenceFormulation ql:JSONPath;
		rml:iterator "$.CVE_Items[*]";
    ];
    rr:subjectMap [
        rr:template "http://w3id.org/sepses/resource/cvss/CVSS3BaseMetric/{cve.CVE_data_meta.ID}";
    ];
	rr:predicateObjectMap [
        rr:predicate rdf:type;
        rr:objectMap [ rr:template "http://w3id.org/sepses/vocab/ref/cvss#CVSS3BaseMetric" ];
    ];
    
    rr:predicateObjectMap [
        rr:predicate cvss:version;
        rr:objectMap [ rml:reference "impact.baseMetricV3.cvssV3.version" ];
        rr:datatype xsd:string ;
    ];
    
      rr:predicateObjectMap [
        rr:predicate cvss:vectorString;
        rr:objectMap [ rml:reference "impact.baseMetricV3.cvssV3.vectorString" ];
        rr:datatype xsd:string ;
    ];
    
    rr:predicateObjectMap [
        rr:predicate cvss:attackVector;
        rr:objectMap [ rml:reference "impact.baseMetricV3.cvssV3.attackVector" ];
        rr:datatype xsd:string ;
    ];
    
      rr:predicateObjectMap [
        rr:predicate cvss:privilegesRequired;
        rr:objectMap [ rml:reference "impact.baseMetricV3.cvssV3.privilegesRequired" ];
        rr:datatype xsd:string ;
    ];
    
    rr:predicateObjectMap [
        rr:predicate cvss:userInteraction;
        rr:objectMap [ rml:reference "impact.baseMetricV3.cvssV3.userInteraction" ];
        rr:datatype xsd:string ;
    ];
    
      rr:predicateObjectMap [
        rr:predicate cvss:scope;
        rr:objectMap [ rml:reference "impact.baseMetricV3.cvssV3.scope" ];
        rr:datatype xsd:string ;
    ];
    
    rr:predicateObjectMap [
        rr:predicate cvss:attackComplexity;
        rr:objectMap [ rml:reference "impact.baseMetricV3.cvssV3.attackComplexity" ];
        rr:datatype xsd:string ;
    ];
    rr:predicateObjectMap [
        rr:predicate cvss:confidentialityImpact;
        rr:objectMap [ rml:reference "impact.baseMetricV3.cvssV3.confidentialityImpact" ];
        rr:datatype xsd:string ;
    ];
    rr:predicateObjectMap [
        rr:predicate cvss:integrityImpact;
        rr:objectMap [ rml:reference "impact.baseMetricV3.cvssV3.integrityImpact" ];
        rr:datatype xsd:string ;
    ];
    rr:predicateObjectMap [
        rr:predicate cvss:availabilityImpact;
        rr:objectMap [ rml:reference "impact.baseMetricV3.cvssV3.availabilityImpact" ];
        rr:datatype xsd:string ;
    ];
    rr:predicateObjectMap [
        rr:predicate cvss:baseScore;
        rr:objectMap [ rml:reference "impact.baseMetricV3.cvssV3.baseScore" ];
        rr:datatype xsd:decimal ;
    ];
    
       rr:predicateObjectMap [
        rr:predicate cvss:baseSeverity;
        rr:objectMap [ rml:reference "impact.baseMetricV3.cvssV3.baseSeverity" ];
        rr:datatype xsd:decimal ;
    ];
.

<#CVEReferenceMapping>
    rml:logicalSource [
        rml:source [
            a carml:Stream;
        ];
        rml:referenceFormulation ql:JSONPath;
		rml:iterator "$.CVE_Items[*]"
    ];
    rr:subjectMap [
        rr:template "http://w3id.org/sepses/resource/cve/reference/{cve.CVE_data_meta.ID}";
    ];



  rr:predicateObjectMap [
        rr:predicate rdf:type;
        rr:objectMap [ rr:template "http://w3id.org/sepses/vocab/ref/cve#Reference" ];
    ];
    rr:predicateObjectMap [
        rr:predicate cve:referenceUrl;
        rr:objectMap [ rml:reference "cve.references.reference_data[*].url" ];
    ];
    rr:predicateObjectMap [
        rr:predicate cve:referenceSource;
         rr:objectMap [ rml:reference "cve.references.reference_data[*].refsource" ];
    ];
    rr:predicateObjectMap [
        rr:predicate cve:referenceName;
         rr:objectMap [ rml:reference "cve.references.reference_data[*].name" ];
    ];
.